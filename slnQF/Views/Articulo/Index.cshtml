@model IEnumerable<slnQF.SP_CONSULTA_SAP_ARTICULO_DATA_USERResult>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_MyLayout.cshtml";
}


<div class="content-wrapper">

    <!-- Content Header (Page header) -->
    <section class="content-header">

        <h1>

            <label id="lbl_titulo">Articulos</label>
            
        </h1>
        <ol class="breadcrumb">
            <li class="active"><a href="#"><i class="fa fa-dashboard"></i><label id="lbl_breadcumb"> </label> </a></li>

        </ol>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <style>
            .loader {
                position: fixed;
                left: 0px;
                top: 0px;
                width: 100%;
                height: 100%;
                z-index: 9999;
                background: url('../../img/page-loader.gif') 50% 50% no-repeat rgb(249,249,249);
            }
        </style>
        <script type="text/javascript">
            $(window).load(function () {
                $(".loader").fadeOut("slow");
            })
        </script>
    </section>

    <!-- Main content -->
    <section class="content">
        <div class="loader"></div>
        <div class="row" id="divRegresa">
            <div class="box box-default">
                <div class="box-header with-border">
                    <h3 class="box-title"><label id="lb_estadtitulo"></label></h3>
                    <div class="box-tools pull-right">
                        <!--<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>-->

                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <div id="divArticulos">
                        <strong>Articulos:</strong>
                        <div data-toggle="buttons">
                            <label class="btn btn-primary active granel">
                                <input type="radio" name="options" id="option1" autocomplete="off" checked> Granel
                            </label>
                            <label class="btn btn-primary terminado">
                                <input type="radio" name="options" id="option2" autocomplete="off"> Terminado
                            </label>
                            <label class="btn btn-primary gobierno">
                                <input type="radio" name="options" id="option3" autocomplete="off"> Gobierno
                            </label>
                            <label class="btn btn-primary exportacion">
                                <input type="radio" name="options" id="option3" autocomplete="off"> Exportacion
                            </label>
                            <label class="btn btn-primary muestramedica">
                                <input type="radio" name="options" id="option3" autocomplete="off"> Muestra Medica
                            </label>
                            <label class="btn btn-primary semielaborado">
                                <input type="radio" name="options" id="option3" autocomplete="off"> Semi Elaborado
                            </label>
                            <label class="btn btn-primary imprenta">
                                <input type="radio" name="options" id="option3" autocomplete="off"> Imprenta
                            </label>
                            <label class="btn btn-primary varios">
                                <input type="radio" name="options" id="option3" autocomplete="off"> Varios
                            </label>
                        </div>
                        <hr />
                        <!--
            <div id="divNuevo">
                <h4>

                    <a href="#" class="glyphicon glyphicon-plus" onclick="OpenCreatePopup()">NUEVO</a>

                </h4>
            </div>
                -->

                        <div>
                            <div class="col-md-12">
                                @{
                                    WebGrid grid = new WebGrid(Model, canPage: false, selectionFieldName: "selectedRow", ajaxUpdateContainerId: "gridContent");
                                }
                                <div>
                                    <div id="gridContent">

                                        @grid.GetHtml(
                                   htmlAttributes: new { width = "100%" },

                                     mode: WebGridPagerModes.All,
                                       tableStyle: "table table-bordered table-hover table-responsive",
                                     columns: new[] {
                                    grid.Column("", header: "", canSort:false,
                                    format: @<text>
                                        @if (item.ID_ITEM != -1)
                                    {
                                            <span class="label label-success">Configurado</span>

                                    }else {
                                            <span class="label label-danger">No Configurado</span>

                                    }


                                    </text>),
                                     grid.Column("", header: "", canSort:false,
                                         format: @<text>

                                        @Html.Raw("<a href='#' onclick=Edit(\'" + item.ITEMCODE+"\',"+ item.ID_ITEM +",\'"+item.SAP_QRYGROUP64+"\') class='glyphicon glyphicon-edit ' title='Editar'> </a>")


                                        @Html.Raw("<a href='#' id='lkEmbalaje"+ item.ITEMCODE +"' onclick=levantaListado(\'" + item.ITEMCODE+"\') class='glyphicon glyphicon-link ' title='Asociar Embalaje'> </a>")

                                        @Html.Raw("<a href='#' id='lkLoteInfo"+ item.ITEMCODE +"' onclick=muestraInfoLote(\'" + item.ITEMCODE+  "\',\'"+ item.ItemName.Replace(" ","_")+ "\') class='glyphicon glyphicon-list lkLoteInfo' title='Informe de operaciones de numeros de lote'> </a>")
                                        @Html.Raw("<a href='#' id='lkLoteConta"+ item.ITEMCODE +"' onclick=muestraContaLote(\'" + item.ITEMCODE+"\',\'"+ item.ItemName.Replace(" ","_")+ "\') class='glyphicon glyphicon-book lkLoteConta' title='Lista de registros contables de inventario'> </a>")

                                        </text>),


                                     grid.Column("ItemCode", "ITEMCODE", null, "text-center", false),
                                     grid.Column("ItemName", "ITEMNAME", null, "text-left", false),
                                     grid.Column("TIPO_ETIQUETA", "ETIQUETA", null, "text-center", false),
                                     grid.Column("CONTENIDO", "CONTENIDO", null, "text-left", false),
                                     grid.Column("VIA_ADMIN", "VIA", null, "text-left", false),
                                     grid.Column("DOSIS", "DOSIS", null, "text-left", false),
                                     grid.Column("HECHO_POR", "HECHO", null, "text-left", false),
                                     grid.Column("CONDICION_ALMACENAMIENTO", "CONDICION ALMACENAJE", null, "text-left", false),
                                     grid.Column("EMPAQUE", "EMPAQUE", null, "text-left", false),
                                     grid.Column("PRESENTACION", "PRESENTACION", null, "text-left", false),
                                     grid.Column("FORMA_FARMACEUTICA", "F.FARMACEUTICA", null, "text-left", false),
                                     grid.Column("ETAPA_FABRICACION", "ETAPA FABRICACION", null, "text-left", false),
                                     grid.Column("INDICACION_VENTA", "INDIC. VENTA", null, "text-left", false),
                                     grid.Column("INDICACION_ESPECIAL", "INDIC. ESPECIAL", null, "text-left", false),
                                     grid.Column("SAP_QRYGROUP64", "EMBALAJE", null, "text-left", false)

                                 })
                                    </div>
                                </div>
                            </div>
                            <div class="modal fade" id="modalEdita" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

                                <div class="modal-dialog" role="document" style="overflow-y: scroll; max-height:80%;  margin-top: 50px; margin-bottom:80px;">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                            <h4 class="modal-title" id="myModalLabel"></h4>
                                        </div>

                                        <div class="box box-primary">
                                            <div class="modal-body ">

                                                <div id="DivToAppendPartialVoew"></div>
                                                <div id="DivToAppendPartialViewList"></div>
                                            </div>
                                            <hr />

                                        </div>

                                        <div class="modal-footer">

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="divInfoLote">
                        <a id="linkRegresa" href="javascript:regresar();"><span class="fa fa-reply "></span>  Regresar </a><br />
                        <strong><label id="lblTituloInfoLote">Informe de operaciones de numeros de lote</label></strong>
                        <div id="divLote"><br /> 
                        </div>
                        <div id="divDetalleLote"><br />

                         
                        </div>
                    </div>
     
                </div>
            </div>
        </div>
    </section>
</div>
<script type="text/javascript">
    initialize();

    function initialize() {
        $("#divInfoLote").hide();

        var elementslkLoteInfo = document.getElementsByClassName("lkLoteInfo");
        for (var i = 0; i < elementslkLoteInfo.length; i++) {
            $('#' + elementslkLoteInfo[i].id).hide()

        }

        var elementslkLoteConta = document.getElementsByClassName("lkLoteConta");
        for (var i = 0; i < elementslkLoteConta.length; i++) {
            $('#' + elementslkLoteConta[i].id).hide()

        }

        $.ajax({
            url: '/Usuario/jsTraeAccesosUser/',
            type: "GET",
            dataType: "JSON",
            data: {},
            async: false,
            success: function (json) {
                var v_cuentaGuardar = 0;
                var v_cuentaVer = 0;
                var v_cuentaLote = 0;
                var v_cuentaRegContable = 0;
                $.each(json, function (j, item2) {
                    //menu operativo
                    if (item2.IDPERMISO == 43 && item2.IDACCESO == 1)
                        v_cuentaGuardar = v_cuentaGuardar + 1;

                    if (item2.IDPERMISO == 43 && item2.IDACCESO == 2)
                        v_cuentaVer = v_cuentaVer + 1;

                    if (item2.IDPERMISO == 71 && item2.IDACCESO == 2)
                        v_cuentaLote = v_cuentaLote + 1;

                    if (item2.IDPERMISO == 72 && item2.IDACCESO == 2)
                        v_cuentaRegContable = v_cuentaRegContable + 1;



                });

                if (v_cuentaLote > 0) {
                    var elementslkLoteInfo2 = document.getElementsByClassName("lkLoteInfo");
                    for (var i = 0; i < elementslkLoteInfo2.length; i++) {
                        $('#' + elementslkLoteInfo2[i].id).show()

                    }
                }
                if (v_cuentaRegContable > 0) {
                    var elementslkLoteConta2 = document.getElementsByClassName("lkLoteConta");
                    for (var i = 0; i < elementslkLoteConta2.length; i++) {
                        $('#' + elementslkLoteConta2[i].id).show()

                    }
                }
                if (v_cuentaVer <= 0) {
                    document.getElementById("gridContent").style.display = "none";
                }
            },
            error: function (error) { console.log(error); }
        });


    }

 

    $(document).on('click', '.granel', function () {
        startSpinGen();
        $("#gridContent").html("");
        $.ajax({
            url: "/Articulo/Index2",
            type: "post",
            data: { "tipo": "07" }
        })
        .done(function (result) {
            stopSpinGen();
            $("#gridContent").html(result);
        });
    });
    $(document).on('click', '.terminado', function () {
        startSpinGen();
        $("#gridContent").html("");
        $.ajax({
            url: "/Articulo/Index2",
            type: "post",
            data: { "tipo": "04" }
        })
        .done(function (result) {
            stopSpinGen();
            $("#gridContent").html(result);
        });
    });

    $(document).on('click', '.gobierno', function () {
        startSpinGen();
        $("#gridContent").html("");
        $.ajax({
            url: "/Articulo/Index2",
            type: "post",
            data: { "tipo": "05" }
        })
        .done(function (result) {
            stopSpinGen();
            $("#gridContent").html(result);
        });
    });

    $(document).on('click', '.exportacion', function () {
        startSpinGen();
        $("#gridContent").html("");
        $.ajax({
            url: "/Articulo/Index2",
            type: "post",
            data: { "tipo": "06" }
        })
        .done(function (result) {
            stopSpinGen();
            $("#gridContent").html(result);
        });
    });

    $(document).on('click', '.muestramedica', function () {
        startSpinGen();
        $("#gridContent").html("");
        $.ajax({
            url: "/Articulo/Index2",
            type: "post",
            data: { "tipo": "08" }
        })
        .done(function (result) {
            stopSpinGen();
            $("#gridContent").html(result);
        });
    });

    $(document).on('click', '.semielaborado', function () {
        startSpinGen();
        $("#gridContent").html("");
        $.ajax({
            url: "/Articulo/Index2",
            type: "post",
            data: { "tipo": "9" }
        })
        .done(function (result) {
            $("#gridContent").html(result);
            stopSpinGen();
        });
    });

    $(document).on('click', '.imprenta', function () {
        startSpinGen();
        $("#gridContent").html("");
        $.ajax({
            url: "/Articulo/Index2",
            type: "post",
            data: { "tipo": "03" }
        })
        .done(function (result) {
            $("#gridContent").html(result);
            stopSpinGen();
        });
    });
    $(document).on('click', '.varios', function () {
        startSpinGen();
        $("#gridContent").html("");
      
        $.ajax({
            url: "/Articulo/Index2",
            type: "post",
            data: { "tipo": "TD" }
        })
        .done(function (result) {
            $("#gridContent").html(result);
            stopSpinGen();
        });
    });

    $(function () {
        $('#gridContent table').DataTable({
            "pageLength": 10,
            //"searching": true,
            "paging": true,

            "searching": true,

            fixedColumns: true,
            "scrollX": true
        });
    });
    function Edit(pid, piditem, pQUERYGROUP64) {
        $("#modalEdita").modal();
        $("#DivToAppendPartialVoew").empty();
        var ph = $("#DivToAppendPartialVoew");
        $("#DivToAppendPartialViewList").empty();
        var val = pid.toString();


        var v_itemcode = pid;
        ph.load("/Articulo/Edit?Id=" + v_itemcode + "&ID_ITEM=" + piditem + "&pQUERYGROUP64=" + pQUERYGROUP64);
    }


    function levantaListado(pid) {
        $("#modalEdita").modal();
        $("#DivToAppendPartialVoew").empty();
        $("#DivToAppendPartialViewList").empty();

        var ph = $("#DivToAppendPartialVoew");
        ph.load("/ItemEmbalaje/Create?Id=" + pid)
        var ph2 = $("#DivToAppendPartialViewList");
        ph2.load("/ItemEmbalaje/Listado?Id=" + pid);
    }

    function muestraInfoLote(pid, pnombre) {
        $("#lblTituloInfoLote").text("Informe de operaciones de numeros de lote, ItemCode: " + pid + " ItemName:" + pnombre.replace(/_/g, " "));
        $("#divLote").empty();
        $("#divDetalleLote").empty();
        var ph = $("#divLote");
        ph.load("/Articulo/ListaMaesLote?IdItemCode=" + pid);
        $("#divArticulos").hide();
        $("#divInfoLote").show();

    }

    function muestraContaLote(pid, pnombre) {
        startSpinGen();
        $("#lblTituloInfoLote").text("Lista de registros contables de inventario, ItemCode: " + pid + " ItemName:" + pnombre.replace(/_/g, " "));
        $("#divLote").empty();
        $("#divDetalleLote").empty();
        var ph = $("#divLote");
        ph.load("/Articulo/ListaContaLote?IdItemCode=" + pid);
        $("#divArticulos").hide();
        $("#divInfoLote").show();

    }
    function regresar() {

        $("#divArticulos").show();
        $("#divInfoLote").hide();

    }
   
    
</script>
